<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Plotting Functionalities</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./control-basics.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-bef9d4b443945b13babc54b38ad9ecc3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./control-basics.html"> 
<span class="menu-text">Process Control &amp; Simulation</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./control-plotting.html">Plotting Functionalities</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./control-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionalities</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./control-plotting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Plotting Functionalities</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#common-graphical-techniques" id="toc-common-graphical-techniques" class="nav-link active" data-scroll-target="#common-graphical-techniques">Common Graphical Techniques</a>
  <ul class="collapse">
  <li><a href="#frequency-analysis---bode-plots" id="toc-frequency-analysis---bode-plots" class="nav-link" data-scroll-target="#frequency-analysis---bode-plots">Frequency Analysis - Bode Plots</a></li>
  <li><a href="#root-locus-diagrams" id="toc-root-locus-diagrams" class="nav-link" data-scroll-target="#root-locus-diagrams">Root Locus Diagrams</a></li>
  <li><a href="#phase-and-gain-margins" id="toc-phase-and-gain-margins" class="nav-link" data-scroll-target="#phase-and-gain-margins">Phase and Gain Margins</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Plotting Functionalities</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<hr>
<p>This demonstration takes advantage of the <code>python-control</code> package to illustrate tools available for computational / numerical process modeling and control. This package implements basic operations for modeling linear, time-invariant (as well as nonlinear, discrete, and stochastic) control systems. Find the documentation for an installation guide and tutorials <a href="https://python-control.readthedocs.io/en/0.10.2/index.html">here</a>.<span class="math inline">\(^{[1]}\)</span></p>
<hr>
<div id="d0ad7365" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># preamble to import packages (renamed using 'import &lt;package&gt; as &lt;name&gt;')</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> control <span class="im">as</span> ctrl</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown, display <span class="co"># to make HTML/Markdown play nicer</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> warnings.catch_warnings():</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    warnings.filterwarnings(<span class="st">"ignore"</span>, message<span class="op">=</span><span class="st">"Ignoring fixed x limits"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    warnings.filterwarnings(<span class="st">"ignore"</span>, message<span class="op">=</span><span class="st">"Ignoring fixed y limits to fulfill fixed data aspect with adjustable data limits."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="common-graphical-techniques" class="level2">
<h2 class="anchored" data-anchor-id="common-graphical-techniques">Common Graphical Techniques</h2>
<p>We’ll jump right in with some high-level plotting functionalities that <code>control</code> provides, namely in generating Bode plots and root locus diagrams.</p>
<hr>
<section id="frequency-analysis---bode-plots" class="level3">
<h3 class="anchored" data-anchor-id="frequency-analysis---bode-plots">Frequency Analysis - Bode Plots</h3>
<p>Recall the utility of Bode plots. They are a graphical tool used to visualize how a given transfer function responds to an oscillatory input, of the form,</p>
<p><span class="math display">\[u(t) = A\sin({\omega t + \phi})\]</span></p>
<p>for a specified amplitude <span class="math inline">\(A\)</span>, frequency <span class="math inline">\(\omega\)</span>, and phase shift <span class="math inline">\(\phi\)</span>. The Bode plot shows the magnitude (amplitude ratio) of oscillations that will be observed in the output, as well as the response’s phase shift.</p>
<p>These plots quickly show us how “well” the dynamics of our system can keep up with this sinusoidal input, as a <mark>function of the incoming frequency of oscillation</mark></p>
<p>Consider a transfer function <span class="math display">\[G(s) = \frac{1}{(\tau_{1}s + 1)(\tau_{2}s + 1)}\]</span></p>
<p>with two poles <span class="math inline">\(p_{1}, p_{2}\)</span> at <span class="math inline">\(s = -\frac{1}{\tau_{1}}, -\frac{1}{\tau_{2}}\)</span> for <span class="math inline">\(\tau_{1}, \tau_{2} = 1, \ 10\)</span>.</p>
<p>With the transfer function properly constructed, we need only to call <code>control.bode_plot()</code> on it for a quick Bode diagram.</p>
<div id="8a4cc6a2" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> ctrl.tf(<span class="st">'s'</span>) <span class="co"># define 's' as a TransferFunction class</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>t1, t2 <span class="op">=</span> <span class="dv">1</span>, <span class="dv">10</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>G1 <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> ((t1<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span>)<span class="op">*</span>(t2<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>ctrl.bode_plot(G1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="control-plotting_files/figure-html/cell-3-output-1.png" width="520" height="475" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>At this point, we’ve seen and approximated many Bode plots. The key takeaways are:</p>
<ol type="1">
<li><p>the <strong>amplitude ratio</strong> represents the ratio of the output signal’s frequency to that of the input signal. Once we reach a frequency where <span class="math inline">\(AR &lt; 1\)</span>, then the output signal becomes more and more attenuated as we continue to increase frequency. In essence, the input begins oscillating so quickly that the output isn’t able to fully reach any maxima of the input – this is precisely the <mark>filtering effect</mark> we’ve discussed in the context of surge tanks that smooth incoming fluctuations in flowrate.</p></li>
<li><p>the <strong>phase shift</strong> stems from the finite dynamics of the process, sensor, control elements, etc. The overall system can’t instantaneously respond to the input, and this manifests as a delay (which is also a function of frequency). We care about the conditions under which we cross <span class="math inline">\(-180^{\circ}\)</span> because at that point, our output signal is completely inverted relative to the input – maxima in input become minima in the output, which can be a problem for feedback schemes (depending on the magnitude at that point)!</p></li>
</ol>
<hr>
</section>
<section id="root-locus-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="root-locus-diagrams">Root Locus Diagrams</h3>
<p>Root locus diagrams are graphical tools used to assess the stability of a system as one of its parameters is varried, usually the controller gain <span class="math inline">\(K_c\)</span>.</p>
<p>Here, we’ll look at one system from homework. Consider the following open-loop transfer function (HW#7):</p>
<p><span class="math display">\[L(s) = G_v G_c G_p G_m = K_{c} \Big( 1 + \frac{1}{\tau_I s} \Big) \frac{1}{(\tau_1 s + 1)(\tau_2 s + 1)}\]</span></p>
<p>for <span class="math inline">\(\tau_I = \frac{1}{2}, \tau_1, \tau_2 = 1, 2\)</span>.</p>
<p>We can then form the <mark>closed-loop response</mark>, and since it’s assumed to be a unity feedback loop (<span class="math inline">\(G_v = G_m = 1\)</span>), then it collapses into a neater form:</p>
<p><span class="math display">\[G_{CL}(s) = \frac{L(s)}{1 + L(s)}\]</span></p>
<p><span class="math display">\[G_{CL}(s) = \frac{G_v G_c G_p}{1 + G_v G_c G_p G_m} = \frac{K_{c} \Big( 1 + \frac{1}{\tau_I s} \Big) \frac{1}{(\tau_1 s + 1)(\tau_2 s + 1)}}{1 + K_{c} \Big( 1 + \frac{1}{\tau_I s} \Big) \frac{1}{(\tau_1 s + 1)(\tau_2 s + 1)}}\]</span></p>
<p>This closed-loop had poles at <span class="math inline">\(s = 0, -1, -\frac{1}{2}\)</span>, a zero at <span class="math inline">\(s = -2\)</span>, a centroid at <span class="math inline">\(\sigma = \frac{1}{4}\)</span>, and the breakaway was <span class="math inline">\(s \approx -0.23\)</span></p>
<p>It’s then straightforward to generate an initial root-locus diagram using <code>control.root_locus_plot()</code>!</p>
<div id="ed7e346b" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Kc <span class="op">=</span> <span class="dv">1</span> <span class="co"># placeholder gain to use in tf construction</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>t1, t2 <span class="op">=</span> <span class="dv">1</span>, <span class="dv">2</span><span class="op">;</span> <span class="co"># time constants in the process and for measurement</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>tI <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="co"># integral time constant</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Gv <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>Gm <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>Gp <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> ((t1<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span>)<span class="op">*</span>(t2<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>Gc <span class="op">=</span> Kc <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">/</span> (tI<span class="op">*</span>s))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> Gv <span class="op">*</span> Gc <span class="op">*</span> Gp <span class="op">*</span> Gm<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>ctrl.root_locus_plot((Gv <span class="op">*</span> Gp <span class="op">*</span> Gc) <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> L), grid <span class="op">=</span> <span class="va">False</span>, xlim <span class="op">=</span> (<span class="op">-</span><span class="fl">2.5</span>, <span class="fl">1.5</span>), ylim <span class="op">=</span> (<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>))<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Ignoring fixed x limits to fulfill fixed data aspect with adjustable data limits.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="control-plotting_files/figure-html/cell-4-output-2.png" width="471" height="474" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wait! It appears some features are missing, such as the trajectories of the poles <span class="math inline">\(p_1 = 0, p_2 = -\frac{1}{2}\)</span> as they breakaway from the Re-axis and start diverging toward the Im-axis…</p>
</div>
</div>
<p>Numerical routines such as the root-finding needed to generate a root-locus diagram are sensitive to numerical precision. Also, generating a diagram for a complex closed-loop transfer function is going to be inherently more complicated than a rather simple function, so key features might be missed by whichever algorithms the code developer included to be used by default.</p>
<p>In the above scenario, you can increase the range of controller gains used in the calculations to capture the breakaway trajectories better, but this doesn’t seem to work directly with the <code>control.root_locus_plot()</code> function. It’s times like these where <mark>by-hand approximations are sometimes the more robust approach!</mark></p>
<hr>
</section>
<section id="phase-and-gain-margins" class="level3">
<h3 class="anchored" data-anchor-id="phase-and-gain-margins">Phase and Gain Margins</h3>
<p>Phase and gain margins are quantitative measures of relative stability of closed-loop systems, or their ‘robustness’ to model uncertainty and process variation.<span class="math inline">\(^{[2]}\)</span></p>
<p>These quantities essentially tell us how far away from <em>marginal stability</em> the system is, so that we can integrate some semblance of safety into operations.</p>
<p>Quickly, we will review a few definitions, and then introduce the newer ones.</p>
<p><strong>(Open) Loop transfer function <span class="math inline">\(L(s)\)</span></strong> – the product of the controller transfer function <span class="math inline">\(G_c(s)\)</span> with an overall process transfer function <span class="math inline">\(G(s)\)</span> (which includes the physical process, any sensors/measurement devices, and control elements such as valves).</p>
<p><span class="math display">\[L(s) = G_c(s)G_v(s)G_p(s)G_m(s) = G_c(s)G(s)\]</span></p>
<p><strong>Marginal stability</strong> – the point at which we observe sustained (non-decaying) oscillations in our output, when the input to the system is a sinusoidal function. <span class="math display">\[1 + L(s=i \omega_u) = 0\]</span></p>
<p>Or,</p>
<p><span class="math display">\[L(s = i \omega_u) = -1\]</span></p>
<p>for an “ultimate” value of <span class="math inline">\(K_c = K_{cu}, \omega = \omega_{u}\)</span>, above which we become unstable, as the poles will begin moving into the right half of the <em>Re-Im</em> plane.</p>
<p><strong>Phase crossover (or <em>critical</em>) frequency <span class="math inline">\(\omega_p\)</span></strong> – the frequency at which the phase of the loop transfer function becomes equal to <span class="math inline">\(-180 ^{\circ}\)</span>.</p>
<p><span class="math display">\[ \omega_p : \angle {L(i \omega_p)} = -180 ^{\circ}\]</span></p>
<p><strong>Gain crossover frequency <span class="math inline">\(\omega_g\)</span></strong> – the frequency at which the magnitude of <span class="math inline">\(L(s)\)</span> becomes equal to one,</p>
<p><span class="math display">\[ \omega_g : |L(i\omega_g)|=1\]</span></p>
<p>With these, we can introduce the phase and gain margins.</p>
<p><strong>Phase margin</strong> <em>PM</em> – the phase shift of the loop transfer function at <span class="math inline">\(\omega_g\)</span> necessary to cause the system to reach <em>marginal stability</em>.</p>
<p>Another interpretation is the <em>distance</em> on the phase diagram between the current phase shift and <span class="math inline">\(-180^{\circ}\)</span>.</p>
<p><span class="math display">\[PM = \arg \big \{ L(i \omega_g) \big \} - (-180^{\circ})\]</span></p>
<p><strong>Gain margin</strong> <em>GM</em> – the factor by which we can scale/multiply the controller gain before the onset of instability</p>
<p><span class="math display">\[GM = \frac{1}{|L(i \omega_p)|}\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember that increasing <span class="math inline">\(K_c\)</span> shifts the amplitude ratio of our transfer function upward on a Bode diagram, while leaving the phase shift unchanged. The opposite is true for a system with time delay; the phase shift will necessarily change, but the magnitude will be left unmodified!</p>
</div>
</div>
<p>A <mark>high gain margin</mark> corresponds to a system that is <mark>far away from instability</mark>, but there is a tradeoff, as our controller responds sluggishly.</p>
<p>A <mark>large phase margin</mark> is also a sign that <mark>the system is far from instability</mark> – there is a safety margin for how much time delay the system can handle before seeing sustained (or worse, growing) oscillations in the output.</p>
<hr>
<section id="example1" class="level4">
<h4 class="anchored" data-anchor-id="example1">Example<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h4>
<p>As an illustration of these quantities, take the following PI- controller, aiming to control some 3rd order process:</p>
<p><span class="math display">\[G(s) = \frac{K}{(\tau_1s + 1)(\tau_2s + 1)(\tau_3s+1)}\]</span></p>
<p>for <span class="math inline">\(\tau_1, \tau_2, \tau_3 = 1, 1/2, 1/3\)</span>.</p>
<p>Our controller has both P- and I-action, which will look like: <span class="math display">\[G_c(s) = K_c (1 + \frac{1}{\tau_I s})\]</span></p>
<p>with a chosen value of <span class="math inline">\(\tau_I = 1/3\)</span>.</p>
<p>We are told the product of our process and controller gains are non-zero, e.g.&nbsp;<span class="math inline">\(K_c K &gt; 0\)</span>, and from a previous example we want to look at the case where <span class="math inline">\(K_c K = 0.5\)</span></p>
<div id="9d147bc7" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">1</span> <span class="co"># loop transfer function (process) gain</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Kc <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># controller gain</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>t1, t2, t3 <span class="op">=</span> <span class="dv">1</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">3</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>tI <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> K <span class="op">/</span> ((t1<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span>)<span class="op">*</span>(t2<span class="op">*</span>s <span class="op">+</span> <span class="dv">1</span>)<span class="op">*</span>(t3<span class="op">*</span>s<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>Gc <span class="op">=</span> Kc <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>(tI<span class="op">*</span>s))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> Gc <span class="op">*</span> G</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>gm, pm, sm, wpc, wgc, wms <span class="op">=</span> ctrl.stability_margins(L)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>ctrl.bode_plot(L)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="control-plotting_files/figure-html/cell-5-output-1.png" width="520" height="475" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="97d49f6b" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>table_md <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ss">| Parameter | Value |</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ss">|:---------:|:-----:|</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ss">| $</span><span class="ch">\\</span><span class="ss">omega_</span><span class="ch">{{</span><span class="ss">pc</span><span class="ch">}}</span><span class="ss">$ | </span><span class="sc">{</span>wpc<span class="sc">:.3f}</span><span class="ss"> |</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ss">| $</span><span class="ch">\\</span><span class="ss">omega_</span><span class="ch">{{</span><span class="ss">gc</span><span class="ch">}}</span><span class="ss">$ | </span><span class="sc">{</span>wgc<span class="sc">:.3f}</span><span class="ss"> |</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ss">| $GM$            | </span><span class="sc">{</span>gm<span class="sc">:.3f}</span><span class="ss">  |</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ss">| $PM$            | </span><span class="sc">{</span>pm<span class="sc">:.1f}</span><span class="ss">° |</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>display(Markdown(table_md))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Parameter</th>
<th style="text-align: center;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\omega_{pc}\)</span></td>
<td style="text-align: center;">1.414</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\omega_{gc}\)</span></td>
<td style="text-align: center;">0.969</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(GM\)</span></td>
<td style="text-align: center;">2.000</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(PM\)</span></td>
<td style="text-align: center;">20.0°</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Do we expect this open-loop transfer function to be step-stable? What might the “output” look like when we simulate a step input?</p>
<p>How about for the fully-connected, closed-loop response?</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall the poles of our <span class="math inline">\(L(s)\)</span> are purely real, and lie in the left-hand portion of the <em>Re-Im</em> plane.</p>
<p><span class="math display">\[ L(s) = (1 + \frac{1}{\tau_I s}) \frac{K_c K}{(\tau_1s + 1)(\tau_2s + 1)(\tau_3s+1)} \]</span></p>
<p><span class="math display">\[ = (\tau_I s + 1) \frac{K_c K}{(\tau_I s)(\tau_1s + 1)(\tau_2s + 1)(\tau_3s+1)} \]</span></p>
</div>
</div>
<p>If we have a standard unity feedback loop, the closed-loop response to a change in setpoint will be:</p>
<p><span class="math display">\[G_{CL,sp} = \frac{L(s)}{1 + L(s)}\]</span></p>
<p>and for a step input, we see the following behavior.</p>
<div id="04ce3d7d" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">25</span>,num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>resp <span class="op">=</span> ctrl.step_response(L <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> L), t)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>resp.plot(plot_inputs<span class="op">=</span><span class="st">'overlay'</span>, legend_map <span class="op">=</span> [<span class="st">'upper left'</span>], label <span class="op">=</span> [<span class="ss">f'$G_CL(t)$'</span>, <span class="ss">f'$u(t) = M(t)$'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="control-plotting_files/figure-html/cell-7-output-1.png" width="520" height="478" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As we might expect, there’s an <strong>initial overshoot</strong>, <strong>oscillation about the step value</strong>, and then the system <strong>settles to our setpoint with no steady-state error</strong>.</p>
<p>Now, let’s make use the calculated gain and phase margins to push this system to the brink of instability to confirm the behavior is as we expect!</p>
<p>In this scenario, <span class="math inline">\((K_c K)_{new} = GM(K_c K)_{old}\)</span></p>
<div id="d5391a63" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">25</span>,num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> L <span class="op">*</span> gm <span class="co"># scale the original loop transfer function by the previously calculated gain margin</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>resp <span class="op">=</span> ctrl.step_response(L <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> L), t)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>resp.plot(plot_inputs<span class="op">=</span><span class="st">'overlay'</span>, legend_map <span class="op">=</span> [<span class="st">'upper left'</span>], label <span class="op">=</span> [<span class="ss">f'$G_CL(t)$'</span>, <span class="ss">f'$u(t) = M(t)$'</span>])</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>gm, pm, sm, wpc, wgc, wms <span class="op">=</span> ctrl.stability_margins(L)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="control-plotting_files/figure-html/cell-8-output-1.png" width="520" height="478" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f7825505" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>table_md <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ss">| Parameter | Value |</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ss">|:---------:|:-----:|</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ss">| $</span><span class="ch">\\</span><span class="ss">omega_</span><span class="ch">{{</span><span class="ss">pc</span><span class="ch">}}</span><span class="ss">$ | </span><span class="sc">{</span>wpc<span class="sc">:.3f}</span><span class="ss"> |</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ss">| $</span><span class="ch">\\</span><span class="ss">omega_</span><span class="ch">{{</span><span class="ss">gc</span><span class="ch">}}</span><span class="ss">$ | </span><span class="sc">{</span>wgc<span class="sc">:.3f}</span><span class="ss"> |</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ss">| $GM$            | </span><span class="sc">{</span>gm<span class="sc">:.3f}</span><span class="ss">  |</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ss">| $PM$            | </span><span class="sc">{</span>pm<span class="sc">:.1f}</span><span class="ss">° |</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>display(Markdown(table_md))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Parameter</th>
<th style="text-align: center;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\omega_{pc}\)</span></td>
<td style="text-align: center;">1.414</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\omega_{gc}\)</span></td>
<td style="text-align: center;">1.414</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(GM\)</span></td>
<td style="text-align: center;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(PM\)</span></td>
<td style="text-align: center;">0.0°</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notice in this table, that the phase crossover frequency <span class="math inline">\(w_{pc}\)</span> did not change (indicating the phase shift of the system was unmodified), yet the gain crossover frequency <span class="math inline">\(w_{gc}\)</span> did! Additionally, these two are coincident at <span class="math inline">\(\omega = \sqrt(2)\)</span></p>
<p>Also, we can see that <span class="math inline">\(GM = 1\)</span>, <span class="math inline">\(PM = 0^{\circ}\)</span>, indicating the gains can’t be scaled any further, and the system can’t handle any more time delay before becoming unstable.</p>
<p>Finally, just to hit the concepts home, we’ll simulate what happens when we increase the gains even further, despite having no wiggle room.</p>
<div id="65e27152" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">25</span>,num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> L <span class="op">*</span> (gm<span class="op">+</span><span class="fl">0.05</span>) <span class="co"># scale the loop transfer function by the gain margin plus some small value</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>resp <span class="op">=</span> ctrl.step_response(L <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> L), t)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>resp.plot(plot_inputs<span class="op">=</span><span class="st">'overlay'</span>, legend_map <span class="op">=</span> [<span class="st">'upper left'</span>], label <span class="op">=</span> [<span class="ss">f'$G_CL(t)$'</span>, <span class="ss">f'$u(t) = M(t)$'</span>])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>gm, pm, sm, wpc, wgc, wms <span class="op">=</span> ctrl.stability_margins(L)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>ctrl.bode_plot(L)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="control-plotting_files/figure-html/cell-10-output-1.png" width="520" height="478" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="control-plotting_files/figure-html/cell-10-output-2.png" width="520" height="475" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="71900320" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>table_md <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ss">| Parameter | Value |</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ss">|:---------:|:-----:|</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ss">| $</span><span class="ch">\\</span><span class="ss">omega_</span><span class="ch">{{</span><span class="ss">pc</span><span class="ch">}}</span><span class="ss">$ | </span><span class="sc">{</span>wpc<span class="sc">:.3f}</span><span class="ss"> |</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ss">| $</span><span class="ch">\\</span><span class="ss">omega_</span><span class="ch">{{</span><span class="ss">gc</span><span class="ch">}}</span><span class="ss">$ | </span><span class="sc">{</span>wgc<span class="sc">:.3f}</span><span class="ss"> |</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ss">| $GM$            | </span><span class="sc">{</span>gm<span class="sc">:.3f}</span><span class="ss">  |</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ss">| $PM$            | </span><span class="sc">{</span>pm<span class="sc">:.1f}</span><span class="ss">° |</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>display(Markdown(table_md))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display cell-output-markdown">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">Parameter</th>
<th style="text-align: center;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\omega_{pc}\)</span></td>
<td style="text-align: center;">1.414</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\omega_{gc}\)</span></td>
<td style="text-align: center;">1.449</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(GM\)</span></td>
<td style="text-align: center;">0.952</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(PM\)</span></td>
<td style="text-align: center;">-1.3°</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Since we’ve pushed the gains of the system and controller too far, now our gain margin is a factor less than 1, and our phase margin is negative.</p>
<hr>
</section>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>[1] S. Fuller, B. Greiner, J. Moore, R. Murray, R. van Paassen and R. Yorke, “The Python Control Systems Library (python-control),” 2021 60th IEEE Conference on Decision and Control (CDC), 2021, pp.&nbsp;4875-4881</p>
<p>[2] Kravaris, C., &amp; Kookos, I. K. (2021). <em>Understanding Process Dynamics and Control</em>. Cambridge University Press.</p>



</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>See Kravaris &amp; Kookos, Ch. 17.2, Example 17.4, “<em>PM and GM of a third-order system under PI control</em>”.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./control-basics.html" class="pagination-link" aria-label="Core Functionalities">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Core Functionalities</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>